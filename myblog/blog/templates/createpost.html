{% extends "base.html" %}
{% load static %}
{% block title %}Create Post{% endblock %}
{% block content %}

<form method="post" action=".">
{% csrf_token %}
    <table border="0">
        <tr>
            <td> Post Title  </td>
            <td> {{ form.title}} </td>
        </tr>
        <tr>
            <td> Post Description  </td>
            <td> {{ form.content}} </td>
        </tr>
        <tr>
            <td> Post category  </td>
            <td>
            <select id="id_category" name="category">
                    <option value="">Select category</option>
                    {% for cat in category %}
                    <option value= {{cat.id}}> {{cat.name}}</option>
                    {% endfor %}
                </select><br>
            </td>
        </tr>
        <tr>
            <td> Post Tags  
                <input type="hidden" id= "hidden_tag" value=""
                 name="hidden_tag">
            </td>
            <td><div class="ui-widget"> {{ form.tags}}</div> </td>
        </tr>
    </table>
    
    <input type="submit" value="Create Post" />
</form>
<link rel="stylesheet" href="http://code.jquery.com/ui/1.8.18/themes/base/jquery-ui.css" type="text/css" media="all" />
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript">
</script> <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.16/jquery-ui.min.js" type="text/javascript"></script>

  <script>
  $(function() {
         tags_id_arr = []
        function split( val ) {
      return val.split( /,\s*/ );
    }
    function extractLast( term ) {
      return split( term ).pop();
    }
  $("#id_tags")
        .on( "keydown", function( event ) {
        if ( event.keyCode === $.ui.keyCode.TAB &&
            $( this ).autocomplete( "instance" ).menu.active ) {
          event.preventDefault();
        }
      })
  .autocomplete({
            source: function( request, response ) {
                $.getJSON( "/blog/get_tags", {
                    term: extractLast( request.term )
                }, response );
            },
            search: function() {
            var term = extractLast( this.value );
            if ( term.length < 2 ) {
                return false;
            }
            },
            focus: function() {
            return false;
            },
            select: function( event, ui ) {
                var terms = split( this.value );
                terms.pop();
                terms.push( ui.item.value );
                terms.push( "" );
                this.value = terms.join( ", " );
                tags_id_arr.push(ui.item.id)
                $("#hidden_tag").val(tags_id_arr)
                return false;
            }
    });
});

  </script>
{% endblock %}
